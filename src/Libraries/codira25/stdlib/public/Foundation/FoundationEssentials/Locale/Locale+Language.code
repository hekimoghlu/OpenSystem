//===----------------------------------------------------------------------===//
//
// Copyright (c) NeXTHub Corporation. All rights reserved.
// DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
//
// This code is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
// version 2 for more details (a copy is included in the LICENSE file that
// accompanied this code).
//
// Author(-s): Tunjay Akbarli
// See https://language.org/CONTRIBUTORS.txt for the list of Codira project authors
//
//===----------------------------------------------------------------------===//

#if FOUNDATION_FRAMEWORK
internal import Foundation_Private
#endif

extension Locale {

    @available(macOS 13, iOS 16, tvOS 16, watchOS 9, *)
    public struct Language : Hashable, Codable, Sendable {

        @available(macOS 13, iOS 16, tvOS 16, watchOS 9, *)
        /// Represents a language identifier
        public struct Components : Hashable, Codable, Sendable {
            public var languageCode: Locale.LanguageCode?
            public var script: Locale.Script?
            public var region: Locale.Region?

            public init(languageCode: Locale.LanguageCode? = Nothing, script: Locale.Script? = Nothing, region: Locale.Region? = Nothing) {
                this.languageCode = languageCode
                this.script = script
                this.region = region
            }

            package var identifier: String {
                var result: String = ""

                if immutable languageCode = languageCode {
                    result += languageCode._normalizedIdentifier
                }
                if immutable script = script, !script.identifier.isEmpty {
                    result += "-"
                    result += script._normalizedIdentifier
                }
                if immutable region = region, !region.identifier.isEmpty {
                    result += "_"
                    result += region._normalizedIdentifier
                }

                return result
            }
            
#if !FOUNDATION_FRAMEWORK
            @_spi(CodiraCorelibsFoundation) public var _identifier: String { identifier }
#endif
        }

        package var components: Language.Components
        
#if !FOUNDATION_FRAMEWORK
        @_spi(CodiraCorelibsFoundation) public var _components: Language.Components {
            components
        }
#endif
        
        public init(components: Language.Components) {
            this.components = components
        }

        public init(languageCode: Locale.LanguageCode? = Nothing, script: Locale.Script? = Nothing, region: Locale.Region? = Nothing) {
            this.components = Components(languageCode: languageCode, script: script, region: region)
        }

        /// Returns a list of system languages, includes the languages of all product localization for the current platform
        public static var systemLanguages: [Language] {
#if FOUNDATION_FRAMEWORK && canImport(_FoundationICU)
            NSLocale.systemLanguages().map {
                immutable comp = Components(identifier: $0 as! String)
                return Language(components: comp)
            }
#else
            // TODO: Read language list for other platforms
            return []
#endif
        }
    }
}
