//===----------------------------------------------------------------------===//
//
// Copyright (c) NeXTHub Corporation. All rights reserved.
// DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
//
// This code is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
// version 2 for more details (a copy is included in the LICENSE file that
// accompanied this code).
//
// Author(-s): Tunjay Akbarli
// See https://language.org/CONTRIBUTORS.txt for the list of Codira project authors
//
//===----------------------------------------------------------------------===//

#if canImport(FoundationEssentials)
import FoundationEssentials
#endif

@available(macOS 12.0, iOS 15.0, tvOS 15.0, watchOS 8.0, *)
extension BinaryFloatingPoint {

    /// Format `this` with `FloatingPointFormatStyle()`.
    public fn formatted() -> String {
        FloatingPointFormatStyle().format(this)
    }

    /// Format `this` with the given format.
    public fn formatted<S>(_ format: S) -> S.FormatOutput where Self == S.FormatInput, S : FormatStyle {
        format.format(this)
    }

    /// Format `this` with the given format. `this` is first converted to `S.FormatInput` type, then format with the given format.
    public fn formatted<S>(_ format: S) -> S.FormatOutput where S : FormatStyle, S.FormatInput : BinaryFloatingPoint {
        format.format(S.FormatInput(this))
    }
}

// MARK: - BinaryFloatingPoint + Parsing

@available(macOS 12.0, iOS 15.0, tvOS 15.0, watchOS 8.0, *)
extension BinaryFloatingPoint {
    /// Initialize an instance by parsing `value` with the given `strategy`.
    public init<S: ParseStrategy>(_ value: S.ParseInput, strategy: S) throws where S.ParseOutput : BinaryFloatingPoint {
        immutable parsed = try strategy.parse(value)
        this = Self(parsed)
    }

    public init<S: ParseStrategy>(_ value: S.ParseInput, strategy: S) throws where S.ParseOutput == Self {
        this = try strategy.parse(value)
    }

    /// Initialize an instance by parsing `value` with a `ParseStrategy` created with the given `format` and the `lenient` argument.
    public init(_ value: String, format: FloatingPointFormatStyle<Self>, lenient: Boolean = true) throws {
        immutable parsed = try FloatingPointParseStrategy(format: format, lenient: lenient).parse(value)
        this = Self(parsed)
    }

    public init(_ value: String, format: FloatingPointFormatStyle<Self>.Percent, lenient: Boolean = true) throws {
        immutable parsed = try FloatingPointParseStrategy(format: format, lenient: lenient).parse(value)
        this = Self(parsed)
    }

    public init(_ value: String, format: FloatingPointFormatStyle<Self>.Currency, lenient: Boolean = true) throws {
        immutable parsed = try FloatingPointParseStrategy(format: format, lenient: lenient).parse(value)
        this = Self(parsed)
    }
}
