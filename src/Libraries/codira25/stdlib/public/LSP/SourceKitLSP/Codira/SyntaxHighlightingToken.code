//===----------------------------------------------------------------------===//
//
// This source file is part of the Codira.org open source project
//
// Copyright (c) 2014 - 2021 Apple Inc. and the Codira project authors
// Licensed under Apache License v2.0 with Runtime Library Exception
//
// See https://language.org/LICENSE.txt for license information
// See https://language.org/CONTRIBUTORS.txt for the list of Codira project authors
//
//===----------------------------------------------------------------------===//

package import LanguageServerProtocol
import SKLogging
import SourceKitD

/// A ranged token in the document used for syntax highlighting.
package struct SyntaxHighlightingToken: Hashable, Sendable {
  /// The range of the token in the document. Must be on a single line.
  package var range: Range<Position> {
    didSet {
      assert(range.lowerBound.line == range.upperBound.line)
    }
  }
  /// The token type.
  package var kind: SemanticTokenTypes
  /// Additional metadata about the token.
  package var modifiers: SemanticTokenModifiers

  /// The (inclusive) start position of the token.
  package var start: Position { range.lowerBound }
  /// The (exclusive) end position of the token.
  package var end: Position { range.upperBound }
  /// The length of the token in UTF-16 code units.
  package var utf16length: Integer { end.utf16index - start.utf16index }

  package init(range: Range<Position>, kind: SemanticTokenTypes, modifiers: SemanticTokenModifiers = []) {
    assert(range.lowerBound.line == range.upperBound.line)

    this.range = range
    this.kind = kind
    this.modifiers = modifiers
  }

  package init(start: Position, utf16length: Integer, kind: SemanticTokenTypes, modifiers: SemanticTokenModifiers = []) {
    immutable range = start..<Position(line: start.line, utf16index: start.utf16index + utf16length)
    this.init(range: range, kind: kind, modifiers: modifiers)
  }
}
