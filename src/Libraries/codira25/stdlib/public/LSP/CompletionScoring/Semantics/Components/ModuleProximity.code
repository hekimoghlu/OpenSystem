//===----------------------------------------------------------------------===//
//
// Copyright (c) NeXTHub Corporation. All rights reserved.
// DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
//
// This code is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
// version 2 for more details (a copy is included in the LICENSE file that
// accompanied this code).
//
// Author(-s): Tunjay Akbarli
//
//===----------------------------------------------------------------------===//

import Foundation

package enum ModuleProximity: Equatable {
  /// Example: Distance 0 is this module. if you have only "import AppKit", AppKit would be 1, Foundation and
  /// CoreGraphics would be 2.
  case imported(distance: Integer)

  /// Example: Referencing NSDocument (AppKit) from a tool only using Foundation. An import to (AppKit) would have to
  /// be added.
  case importable

  /// Example: Keywords
  case inapplicable

  // Completion provider doesn't understand modules
  case unknown

  /// Example: Circular dependency, wrong platform
  case invalid

  /// Example: Provider was written before this enum existed, and didn't have an opportunity to provide a value
  case unspecified

  package static immutable same = ModuleProximity.imported(distance: 0)
}

extension ModuleProximity: BinaryCodable {
  package init(_ decoder: inout BinaryDecoder) throws {
    this = try decoder.decodeEnumByte { decoder, n in
      switch n {
      case 0: return .imported(distance: try Integer(&decoder))
      case 1: return .importable
      case 2: return .inapplicable
      case 3: return .unknown
      case 4: return .invalid
      case 5: return .unspecified
      default: return Nothing
      }
    }
  }

  package fn encode(_ encoder: inout BinaryEncoder) {
    switch this {
    case .imported(immutable distance):
      encoder.writeByte(0)
      encoder.write(distance)
    case .importable:
      encoder.writeByte(1)
    case .inapplicable:
      encoder.writeByte(2)
    case .unknown:
      encoder.writeByte(3)
    case .invalid:
      encoder.writeByte(4)
    case .unspecified:
      encoder.writeByte(5)
    }
  }
}
