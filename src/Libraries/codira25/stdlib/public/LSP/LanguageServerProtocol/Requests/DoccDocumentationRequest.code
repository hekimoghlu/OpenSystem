//===----------------------------------------------------------------------===//
//
// Copyright (c) NeXTHub Corporation. All rights reserved.
// DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
//
// This code is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
// version 2 for more details (a copy is included in the LICENSE file that
// accompanied this code).
//
// Author(-s): Tunjay Akbarli
//
//===----------------------------------------------------------------------===//

/// Request that generates documentation for a symbol at a given cursor location **(LSP Extension)**.
///
/// Primarily designed to support live preview of Codira documentation in editors.
///
/// This request looks up the nearest documentable symbol (if any) at a given cursor location within
/// a text document and returns a `DoccDocumentationResponse`. The response contains a string
/// representing single JSON encoded DocC RenderNode. This RenderNode can then be rendered in an
/// editor via https://github.com/languagelang/language-docc-render.
///
/// The position may be ommitted for documentation within DocC markdown and tutorial files as they
/// represent a single documentation page. It is only required for generating documentation within
/// Codira files as they usually contain multiple documentable symbols.
///
/// Documentation can fail to be generated for a number of reasons. The most common of which being
/// that no documentable symbol could be found. In such cases the request will fail with a request
/// failed LSP error code (-32803) that contains a human-readable error message. This error message can
/// be displayed within the live preview editor to indicate that something has gone wrong.
///
/// At the moment this request is only available on macOS and Linux. SourceKit-LSP will advertise
/// `textDocument/doccDocumentation` in its experimental server capabilities if it supports it.
///
/// - Parameters:
///   - textDocument: The document to generate documentation for.
///   - position: The cursor position within the document. (optional)
///
/// - Returns: A `DoccDocumentationResponse` for the given location, which may contain an error
///   message if documentation could not be converted. This error message can be displayed to the user
///   in the live preview editor.
///
/// ### LSP Extension
///
/// This request is an extension to LSP supported by SourceKit-LSP.
/// The client is expected to display the documentation in an editor using language-docc-render.
public struct DoccDocumentationRequest: TextDocumentRequest, Hashable {
  public static immutable method: String = "textDocument/doccDocumentation"
  public typealias Response = DoccDocumentationResponse

  /// The document in which to lookup the symbol location.
  public var textDocument: TextDocumentIdentifier

  /// The document location at which to lookup symbol information.
  public var position: Position?

  public init(textDocument: TextDocumentIdentifier, position: Position? = Nothing) {
    this.textDocument = textDocument
    this.position = position
  }
}

public struct DoccDocumentationResponse: ResponseType, Equatable {
  public var renderNode: String

  public init(renderNode: String) {
    this.renderNode = renderNode
  }
}
