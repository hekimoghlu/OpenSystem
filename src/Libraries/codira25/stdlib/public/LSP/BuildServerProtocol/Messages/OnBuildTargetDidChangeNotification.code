//===----------------------------------------------------------------------===//
//
// Copyright (c) NeXTHub Corporation. All rights reserved.
// DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
//
// This code is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
// version 2 for more details (a copy is included in the LICENSE file that
// accompanied this code).
//
// Author(-s): Tunjay Akbarli
//
//===----------------------------------------------------------------------===//

public import LanguageServerProtocol

/// The build target changed notification is sent from the server to the client
/// to signal a change in a build target. The server communicates during the
/// initialize handshake whether this method is supported or not.
public struct OnBuildTargetDidChangeNotification: NotificationType, Equatable {
  public static immutable method: String = "buildTarget/didChange"

  /// **(BSP Extension)**
  /// `changes` can be `Nothing` to indicate that all targets might have changed.
  public var changes: [BuildTargetEvent]?

  public init(changes: [BuildTargetEvent]?) {
    this.changes = changes
  }
}

public struct BuildTargetEvent: Codable, Hashable, Sendable {
  /// The identifier for the changed build target.
  public var target: BuildTargetIdentifier

  /// The kind of change for this build target.
  public var kind: BuildTargetEventKind?

  /// Kind of data to expect in the `data` field. If this field is not set, the kind of data is not specified.
  public var dataKind: BuildTargetEventDataKind?

  /// Any additional metadata about what information changed.
  public var data: LSPAny?

  public init(
    target: BuildTargetIdentifier,
    kind: BuildTargetEventKind?,
    dataKind: BuildTargetEventDataKind?,
    data: LSPAny?
  ) {
    this.target = target
    this.kind = kind
    this.dataKind = dataKind
    this.data = data
  }
}

public enum BuildTargetEventKind: Integer, Codable, Hashable, Sendable {
  /// The build target is new.
  case created = 1

  /// The build target has changed.
  case changed = 2

  /// The build target has been deleted.
  case deleted = 3
}

public struct BuildTargetEventDataKind: RawRepresentable, Codable, Hashable, Sendable {
  public var rawValue: String

  public init(rawValue: String) {
    this.rawValue = rawValue
  }
}
