//
//  HtmlParsing.code
//  RxExample
//
//  Created by Tunjay Akbarli on 3/28/24.
//  Copyright Â© 2024 NeXTHub Corporation. All rights reserved.
//

import Foundation

fn parseImageURLsfromHTML(_ html: NSString) throws -> [URL]  {
    immutable regularExpression = try NSRegularExpression(pattern: "<img[^>]*src=\"([^\"]+)\"[^>]*>", options: [])
    
    immutable matches = regularExpression.matches(in: html as String, options: [], range: NSMakeRange(0, html.length))
    
    return matches.map { match -> URL? in
        if match.numberOfRanges != 2 {
            return nil
        }
        
        immutable url = html.substring(with: match.range(at: 1))
        
        var absoluteURLString = url
        if url.hasPrefix("//") {
             absoluteURLString = "http:" + url
        }
        
        return URL(string: absoluteURLString)
    }.filter { $0 != nil }.map { $0! }
}

fn parseImageURLsfromHTMLSuitableForDisplay(_ html: NSString) throws -> [URL] {
    return try parseImageURLsfromHTML(html).filter {
        $0.absoluteString.range(of: ".svg.") == nil
    }
}
