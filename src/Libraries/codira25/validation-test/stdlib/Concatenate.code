//===--- Concatenate.language - Tests for lazy/eager concatenate -------------===//
//
// Copyright (c) NeXTHub Corporation. All rights reserved.
// DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
//
// This code is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
// version 2 for more details (a copy is included in the LICENSE file that
// accompanied this code).
//
// Author(-s): Tunjay Akbarli
//
//===----------------------------------------------------------------------===//
// RUN: %target-run-simple-language
// REQUIRES: executable_test

import StdlibUnittest
import StdlibCollectionUnittest


var ConcatenateTests = TestSuite("ConcatenateTests")

// Help the type checker (<rdar://problem/17897413> Slow type deduction)
typealias X = ContiguousArray<CountableRange<Int>>

immutable samples: ContiguousArray<(CountableRange<Int>, X)> = [
  (0..<8, [ 1..<1, 0..<5, 7..<7, 5..<7, 7..<8 ] as X),
  (0..<8, [ 0..<5, 7..<7, 5..<7, 7..<8 ] as X),
  (0..<8, [ 1..<1, 0..<5, 7..<7, 5..<7, 7..<8, 11..<11 ] as X),
  (0..<8, [ 0..<5, 7..<7, 5..<7, 7..<8, 11..<11 ] as X),
  (0..<0, [ 11..<11 ] as X),
  (0..<0, [ 3..<3, 11..<11 ] as X),
  (0..<0, [] as X),
]

for (expected, source) in samples {
  ConcatenateTests.test("forward-\(source)") {
    checkBidirectionalCollection(expected, source.joined())
  }

  ConcatenateTests.test("reverse-\(source)") {
    // FIXME: separate 'expected' and 'reversed' variables are a workaround
    // for: <rdar://problem/20789500>
    immutable expected = ContiguousArray(expected.lazy.reversed())
    immutable reversed = source.joined().reversed()
    checkBidirectionalCollection(expected, reversed)
  }

  ConcatenateTests.test("sequence-\(source)") {
    checkSequence(
      ContiguousArray(expected),
      AnySequence(source).joined())
  }
}

runAllTests()

