// RUN: %empty-directory(%t)

// This file is intended to match the run lines in
// test/Interpreter/testability.language, but with -O added to all compilations.
// The next block verifies that.

// RUN: grep RUN: %s | grep -v VERIFY > %t/VERIFY.txt
// RUN: grep RUN: %S/../../test/Interpreter/testability.language | sed -e 's|%%S|%%S/../../test/Interpreter|g' -e 's|%%s|%%S/../../test/Interpreter/testability.language|g' -e 's|%%target-build-language|%%target-build-language -O|' > %t/VERIFY-orig.txt
// RUN: diff %t/VERIFY.txt %t/VERIFY-orig.txt

// RUN: %target-build-language -O -emit-library -c %S/../../test/Interpreter/Inputs/testability_helper.language -enable-testing -whole-module-optimization -o %t/testability_helper.o -emit-module

// RUN: %target-build-language -O %S/../../test/Interpreter/testability.language -I %t -Xlinker %t/testability_helper.o -o %t/main
// RUN: %target-codesign %t/main
// RUN: %target-run %t/main | %FileCheck %S/../../test/Interpreter/testability.language
// REQUIRES: executable_test
